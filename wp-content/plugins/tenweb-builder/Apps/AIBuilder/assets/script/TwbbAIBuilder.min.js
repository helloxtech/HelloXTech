function twbbRequests(e,t,i=!1,s="",a="application/json"){return new Promise(((n,o)=>{try{const r={"Content-Type":a};twbb_ai_builder.reseller_mode?i&&(r["x-api-key"]=twbb_ai_builder.builder_kit_api_key):(r.Accept="application/x.10webaiassistantapi.v1+json",r.Authorization="Bearer "+twbb_ai_builder.access_token);const l={method:e,headers:r};""!==s&&(l.body=s),fetch(twbb_ai_builder.builder_api+t,l).then((e=>e.json())).then((e=>{200===e.status?n(e):o(new Error("Unexpected response format or request not successful."))}))}catch(e){o(e)}}))}function twbSendEventToRouth(e){try{const t=Object.keys(e).reduce(((t,i)=>(t[i.split(/(?=[A-Z])/).join("_").toLowerCase()]=e[i],t)),{});header={Accept:"application/x.10webcore.v1+json"},header["x-api-key"]=twbb_ai_builder.builder_kit_api_key,jQuery.ajax({type:"POST",headers:header,url:twbb_ai_builder.send_ga_event,dataType:"json",data:t,success:function(e){},error:function(e,t,i){console.log(`AJAX error: ${t} - ${i}`)}})}catch(e){console.log("Error sending the events: ",e)}}function twbbSetAnimations(e){jQuery(".twbb-ai-builder__left-content.slide_up_text .text-slide-up").each((function(){const e=jQuery(this).text(),t=jQuery(this).attr("data-animate"),i=e.split(" "),s="slideUp1"===t?90:60,a=i.map(((e,t)=>`<span style="animation-delay: ${t*s}ms">${e}</span>`)).join(" ");jQuery(this).addClass("show").html(a)}))}function safeJsonParse(e){try{return JSON.parse(e)}catch(t){try{const t=e.replace(/\\"/g,'"');return JSON.parse(t)}catch(e){return null}}}async function twbbShowGenerationCount(){try{let e=`templates/workspaces/${twbb_ai_builder.workspace_id}/generation-count`;twbb_ai_builder.reseller_mode&&(e="templates/generation-count");const t=await twbbRequests("GET",e,!0);t&&200===t.status&&twbbChangeButtonsInfo(t.data)}catch(e){console.log("Error fetching data",e)}}function twbbChangeButtonsInfo(e){const t=jQuery(".twbb-ai-builder-page"),i=t.find(".twbb-ai-builder-page__button-container.generate"),{can_regenerate:s,count:a,plan_regeneration_limit:n}=e||{};s||(i.addClass("disabled"),i.find(".twbb-ai-builder-page__button").addClass("disabled")),t.find("#generated_count").html(a),t.find("#generation_count").html(n),t.find(".generation-count").removeClass("hidden")}jQuery(document).ready((function(){twbbShowGenerationCount();const e=jQuery(".wrap .page-title-action").first();e.length&&jQuery("<a>",{class:"twbb-add-page-with-ai twbb-ai-builder-page__button","data-id":"single_page",text:"Add page with AI"}).insertAfter(e)}));class TwbbBusinessType{constructor(e){this.params=e,this.container=jQuery('.twbb-ai-builder__container[data-type="businessType"]'),this.selectcontainer=jQuery(".select_container"),this.options=[],""!==this.params.business_type&&this.fillData()}fillData(){this.container.find("#business-type").val(this.params.business_type),jQuery(".twbb-ai-builder__btn.next").removeClass("disabled")}changeInfo(){const e=this.container,t=this.params.website_type,i=twbb_ai_builder[`business_type_${t}_title`],s=twbb_ai_builder[`business_type_${t}_label`],a=twbb_ai_builder[`business_type_${t}_placeholder`],n=twbb_ai_builder.image_url+`banners/${t}.jpg`;e.find(".twbb-ai-builder__title").html(i),e.find(".label").html(s),e.find(".search").attr("placeholder",a),e.find(".twbb-ai-builder__left-banner").css("background-image",`url(${n})`)}async getOptions(){const e=this,t="ecommerce"===e.params.website_type?"ecommerce":"basic";try{let i=`proxy/generative/categories?website_type=${t}`;twbb_ai_builder.reseller_mode&&(i=`templates/generative/categories?website_type=${t}`);const s=await twbbRequests("GET",i,!0);if(s&&200===s.status){let t=s.data;t=t.map((e=>({name:e.name,title:e.title}))),this.options=t,t=e.shuffle(t),e.printOptions(t),e.optionClick()}}catch(e){console.log("Error fetching data",e)}}optionClick(){const e=this.selectcontainer;jQuery(".select_container .option").on("click",(function(){const t=jQuery(this).text();e.removeClass("active"),e.find(".option").removeClass("selected"),jQuery(this).addClass("selected"),e.find("#business-type").val(t),jQuery(".twbb-ai-builder__btn.next").removeClass("disabled"),localStorage.removeItem("formData")}))}searchOptions(e,t){const i=this,s=e.val(),a="ecommerce"===t?"ecommerce":"basic",n=JSON.stringify({input:s,website_type:a});let o=`${twbb_ai_builder.twbb_fe_service}api/onboarding/search_categories`;twbb_ai_builder.reseller_mode&&(o=`${twbb_ai_builder.builder_api}onboarding/search_categories`),fetch(o,{method:"POST",headers:{Accept:"application/x.10webx.v1+json","Content-Type":"application/json"},body:n}).then((e=>e.json())).then((e=>{const t=e;if("success"===t.status){const e=t.data;i.printOptions(e,s)}else i.printOptions(i.options,s);i.optionClick()}))}printOptions(e,t=""){const i=this.selectcontainer.find(".options"),s=new RegExp(t,"gi");let a="";for(const i in e){const n=e[i].title,o=n.replace(s,(function(e){return"<span class='highlighted'>"+e+"</span>"})),r=t?o:n;a+='<p class="option " data-value="'+e[i].name+'">'+r+"</p>"}i.html(a)}showOptions(){this.selectcontainer.addClass("active")}hideOptions(){this.selectcontainer.removeClass("active")}shuffle(e){let t,i,s;for(s=e.length-1;s>0;s--)t=Math.floor(Math.random()*(s+1)),i=e[s],e[s]=e[t],e[t]=i;return e}}class TwbbAboutWebsite{constructor(e,t){this.container=jQuery('.twbb-ai-builder__container[data-type="aboutWebsite"]'),this.params=e,this.isSinglePage=t,this.businessType=this.params.business_type,""!==this.params.business_name&&this.fillData()}fillData(){this.container.find("#business-name").val(this.params.business_name),this.container.find("#business-description").val(this.params.business_description)}async changeInfo(e,t={}){let i=this.isSinglePage?"single_page":e.website_type,s={};const a=this.container,n=twbb_ai_builder[`about_website_${i}_title`],o=twbb_ai_builder[`about_website_${i}_desc`],r=twbb_ai_builder[`about_website_${i}_example`],l=jQuery(".twbb-ai-builder__left-content.slide_up_text"),b=a.find(".create-info"),c=a.find(".twbb-ai-builder__left"),u=Object.keys(t).length>0;if(a.find(".twbb-ai-builder__title").html(n),a.find(".twbb-ai-builder__desc").html(o),this.isSinglePage){const e=twbb_ai_builder[`about_website_${i}_title_label`],t=twbb_ai_builder[`about_website_${i}_title_placeholder`],s=twbb_ai_builder[`about_website_${i}_desc_label`],n=twbb_ai_builder[`about_website_${i}_desc_placeholder`];a.find(".business-name .input-label").html(e),a.find(".business-name .twbb-input").attr("placeholder",t),a.find(".business-description .input-label").html(s),a.find(".business-description .twbb-input").attr("placeholder",n),!c.find(".slide_up_text").length&&c.append(l.clone()),twbbSetAnimations(i),b.addClass("hidden")}else a.find(".example-content").html(r),b.removeClass("hidden"),c.find(".slide_up_text").length&&c.find(".slide_up_text").remove(),u&&this.setInputsInfo(t),s=u?t:await this.getInputsInfo();return this.validateInfo(),s}async getInputsInfo(){const e=this,t=this.businessType;try{let i=`proxy/generative/templates/questions?template_selection=usability&category=${t}`;twbb_ai_builder.reseller_mode&&(i=`templates/generative/questions?template_selection=usability&category=${t}`);const s=await twbbRequests("GET",i,!0);if(s&&200===s.status){let t=s.data,i=t.questions?.lang_name_desc_domain?.inputs??[];return i.length||(i=t.questions?.a_lang_name_desc_domain?.inputs??[]),i=i.reduce(((e,t)=>(("textarea"===t?.field_type||"text"===t?.field_type&&"domain_name"!==t?.name)&&(e[t.field_type]=t),e)),{}),e.setInputsInfo(i),i}}catch(e){return console.log("Error fetching data",e),!1}}setInputsInfo(e){this.container.find(".input-wrap").each((function(){const t=jQuery(this).attr("data-type"),i=e[t];jQuery(this).find(".input-label").html(i.label),jQuery(this).find(".twbb-input").attr("placeholder",i.placeholder)}))}validateInfo(){const e=this;e.container.find(".twbb-input").on("change",(function(){e.validateInputs(jQuery(this),"change")})).on("keyup",(function(){e.validateInputs(jQuery(this),"keyup")})).on("blur",(function(){e.validateInputs(jQuery(this),"blur"),jQuery(this).addClass("touched")}))}validateInputs(e,t){const i=e.closest(".input-wrap"),s=this.container.find(".twbb-input"),a=e.val().trim(),n=a.length,o=(()=>{switch(e.attr("id")){case"business-name":return""===a?"This field is required.":"";case"business-description":return""===a?"This field is required.":n<20?"To get better results input no less than 20 symbols.":n>800?"Character limit reached.":"";default:return""}})();o?("keyup"!==t||"keyup"===t&&e.hasClass("touched"))&&(i.addClass("error-wrap"),i.find(".error-msg").html(o).removeClass("hidden")):(i.removeClass("error-wrap"),i.find(".error-msg").html("").addClass("hidden"));const r=s.toArray().every((e=>{const t=jQuery(e).val().trim();if(jQuery(e).closest(".input-wrap").hasClass("error-wrap"))return!1;switch(jQuery(e).attr("id")){case"business-name":return""!==t;case"business-description":return t.length>=20&&t.length<=800;default:return!0}}));jQuery(".twbb-ai-builder__btn.next").toggleClass("disabled",!r)}}class TwbbEcommerceData{constructor(){this.container=jQuery('.twbb-ai-builder__container[data-type="ecommerceData"]')}changeInfo(e){const t=this.container,i=twbb_ai_builder[`about_website_${e}_title`],s=twbb_ai_builder[`about_website_${e}_desc`],a=twbb_ai_builder[`about_website_${e}_example`];t.find(".twbb-ai-builder__title").html(i),t.find(".twbb-ai-builder__desc").html(s),t.find(".example-content").html(a)}async ecomData(e,t){const i=this;try{const s={business_type:t.business_type,business_name:t.business_name,business_description:t.business_description,website_type:t.website_type,tier1:!1};let a={params:JSON.stringify(s),uniqueId:e,service_key:"gTcjslfqqBFFwJKBnFgQYhkQEJpplLaDKfj"},n="ai2/ecom_data";twbb_ai_builder.reseller_mode&&(n="builder/ecom_data");const o=await twbbRequests("POST",n,!0,JSON.stringify(a));if(o){if(200===o.status){const e=o.data?.categories??[];i.setInputsInfo(e);const{language_code:t,...s}=o.data;return s}return!1}}catch(e){return console.log("Error fetching data",e),!1}}setInputsInfo(e){this.container.find(".twbb-input").each((function(t,i){e[t]&&jQuery(this).val(e[t])}))}}class TwbbWebsiteStyle{constructor(e,t,i){this.container=jQuery('.twbb-ai-builder__container[data-type="websiteStyle"]'),this.customizerContainer=jQuery(".website-customizer-container"),this.historyKey=e,this.uniqueId=t,this.isMobile=i,this.count=0,this.styles={"--accentColor":"#18778f","--secondaryColor":"#f5f0e8","--accentColorShade":"#18778f0A","--accentColorShade2":"#18778f1A","--mainFontFamily":"Georgia"},this.theme="classic",this.font={primary_font:"Montserrat"},this.color={primary_color:"#18778f",secondary_color:"#f5f0e8",background_dark:"#18778f"},this.colors=[{title:"Indigo",primaryColor:"#283566",secondaryColor:"#986424"},{title:"Han blue",primaryColor:"#3A5BCC",secondaryColor:"#898989"},{title:"Orchid pink",primaryColor:"#E33665",secondaryColor:"#898989"},{title:"Basque green",primaryColor:"#5A5E32",secondaryColor:"#DBC75B"},{title:"Red berry",primaryColor:"#5F1928",secondaryColor:"#DE87C2"},{title:"Purplish blue",primaryColor:"#5833F1",secondaryColor:"#898989"},{title:"Obsidian shell",primaryColor:"#821FA0",secondaryColor:"#F4C730"},{title:"Beagle brown",primaryColor:"#8D6D36",secondaryColor:"#9EBD59"},{title:"Aurora orange",primaryColor:"#ED6744",secondaryColor:"#A7A2A0"}],this.themes=[{title:"Classic",font:"Georgia",class:"classic"},{title:"Flat",font:"PT Sans",class:"flat"},{title:"Material",font:"Montserrat",class:"material"},{title:"Minimalistic",font:"Lexend",class:"minimalistic"},{title:"Soft",font:"Poppins",class:"soft"}]}getActiveThemes(){return{colors:this.color,fonts:this.font,theme:this.theme}}setColorsThemes(e){const t=this,i=this.container,s=JSON.parse("{}"),a="1"===localStorage.getItem("fieldData"),n=a?s:e,o=e.colors&&!a?n?.colors:s?.generated_color;if(0===this.count){const e={title:"AI",primaryColor:o?.primary_color??this.color.primary_color,secondaryColor:o?.secondary_color??this.color.secondary_color};this.color={primary_color:o?.primary_color??this.color.primary_color,secondary_color:o?.secondary_color??this.color.secondary_color},a||(e.selected=!0),this.colors.unshift(e),a?(this.colors.forEach((e=>{e.primaryColor===s?.colors?.primary_color&&e.secondaryColor===s?.colors?.secondary_color&&(e.selected=!0)})),this.themes.forEach((e=>{e.font===s?.fonts?.primary_font&&(e.selected=!0,this.theme=e.class)}))):(this.changeHistory({generated_color:e}),this.themes[0].selected=!0,localStorage.setItem("fieldData","0")),this.count++}this.styles["--accentColor"]=n.colors.primary_color,this.styles["--secondaryColor"]=n.colors.secondary_color,this.styles["--accentColorShade"]=`${n.colors.primary_color}0A`,this.styles["--accentColorShade2"]=`${n.colors.primary_color}1A`,this.styles["--mainFontFamily"]=n.fonts.primary_font;const r=this.colors.map((e=>`\n      <div class="color-item ${e.selected?"selected":""}" data-title="${e.title}">\n        <div class="color-set-container">\n          <div class="color" style="background-color:${e.primaryColor}"></div>\n          <div class="color" style="background-color:${e.secondaryColor}"></div>\n        </div>\n      </div>`)).join(""),l=this.themes.map((e=>{const t=e.selected?"selected":"";return`\n      <div class="theme ${e.class} ${t}" data-title="${e.title}">\n        <div>\n          <span class="theme-title">${e.title}</span>\n          <span class="theme-paragraph">This is your paragraph.</span>\n        </div>\n        <a class="theme-btn ${e.class}">\n          <span>Button</span>\n        </a>\n      </div>`})).join("");i.find(".color-picker-container .list").html(r),i.find(".themes-picker-container .list").html(l),jQuery(document).on("click",'.twbb-ai-builder__container[data-type="websiteStyle"] .color-item',(function(){t.switchColor(jQuery(this))})),jQuery(document).on("click",'.twbb-ai-builder__container[data-type="websiteStyle"] .theme',(function(){t.switchTheme(jQuery(this))})),this.changeStyles()}switchColor(e){const t=e.attr("data-title"),i=this.colors.filter((e=>e.title===t));this.color={primary_color:i[0]?.primaryColor,secondary_color:i[0]?.secondaryColor},this.styles["--accentColor"]=i[0]?.primaryColor,this.styles["--secondaryColor"]=i[0]?.secondaryColor,this.styles["--accentColorShade"]=`${i[0]?.primaryColor}0A`,this.styles["--accentColorShade2"]=`${i[0]?.primaryColor}1A`,this.changeHistory({colors:this.color}),this.changeStyles(),jQuery('.twbb-ai-builder__container[data-type="websiteStyle"] .color-item').removeClass("selected"),e.addClass("selected"),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Customize Website",eventLabel:"Choose Color",uniqueId:this.uniqueId,isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Customize Website",eventLabel:"Choose Color",uniqueId:this.uniqueId,isMobile:this.isMobile})}switchTheme(e){const t=e.attr("data-title"),i=this.themes.filter((e=>e.title===t));this.styles["--mainFontFamily"]=i[0]?.font,this.theme=i[0]?.class,this.font={primary_font:i[0]?.font},this.changeHistory({fonts:this.font,theme:this.theme}),this.changeStyles(),jQuery('.twbb-ai-builder__container[data-type="websiteStyle"] .theme').removeClass("selected"),e.addClass("selected"),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Customize Website",eventLabel:"Choose Theme",uniqueId:this.uniqueId,isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Customize Website",eventLabel:"Choose Theme",uniqueId:this.uniqueId,isMobile:this.isMobile})}changeStyles(){let e="";for(const t in this.styles)this.styles.hasOwnProperty(t)&&(e+=t+":"+this.styles[t]+";");this.customizerContainer.attr("style",e),this.customizerContainer.removeAttr("class"),this.customizerContainer.addClass("website-customizer-container").addClass(this.theme)}changeHistory(e){const t={};if(t)for(const i in e)t[i]=e[i];localStorage.setItem(this.historyKey,JSON.stringify(t))}}class TwbbOutline{constructor(){this.container=jQuery('.twbb-ai-builder__container[data-type="outline"]')}changeInfo(){const e=this.container;e.find(".twbb-ai-builder__title").html(twbb_ai_builder.outline_modify_title),e.find(".twbb-ai-builder__desc").html(twbb_ai_builder.outline_modify_desc),e.find(".twbb-lazy-load").removeClass("twbb-lazy-load"),jQuery(".twbb-ai-builder__btn.next").removeClass("disabled")}}class TwbbGeneration{constructor(e,t,i,s,a){this.container=jQuery('.twbb-ai-builder__container[data-type="generation"]'),this.isEcommerce="ecommerce"===i,this.uniqueId=t,this.isMobile=s,this.isSinglePage=a,this.steps=this.isSinglePage?twbb_ai_builder.mobile_steps:twbb_ai_builder.steps.filter((e=>e.isEcommerce===this.isEcommerce||void 0===e.isEcommerce)),e.image_model="default",e.trial_hosted_flow=0,e.ai_type="ai_builder_demo",e.domain_name=JSON.stringify({want_domain:0,domain_name:""}),this.params=e;const n=this;jQuery(document).on("click",".twbb-ai-builder__popup.retry .twbb-ai-builder__btn",(function(){n.generateWebsite(),jQuery(this).closest(".twbb-ai-builder-overlay").addClass("hidden")})),jQuery(document).on("click",".twbb-ai-builder__popup.congrats .twbb-ai-builder__btn",(function(){jQuery(this).closest(".twbb-ai-builder-overlay").addClass("hidden"),jQuery(this).closest(".twbb-ai-builder").addClass("hidden"),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:n.isMobile?"Section-based AI Flow - Preview":"Section-based AI Flow - Preview and Edit",eventLabel:"",websiteType:"basic"===n.params.website_type?"Business":"Ecommerce",uniqueId:n.uniqueId,isMobile:n.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:n.isMobile?"Section-based AI Flow - Preview":"Section-based AI Flow - Preview and Edit",eventLabel:"",websiteType:"basic"===n.params.website_type?"Business":"Ecommerce",uniqueId:n.uniqueId,isMobile:n.isMobile}),setTimeout((()=>location.reload()),200)}))}async generateWebsite(){const e=this;let t;"ecommerce"===this.params.website_type&&this.installWoocommerce(),this.changeInfo(),this.printSteps();let i=!1,s="generate_site_files_from_description";if(twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Generation Started",eventLabel:"",uniqueId:this.uniqueId,isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Generation Started",eventLabel:"",uniqueId:this.uniqueId,isMobile:this.isMobile}),this.isSinglePage?(i=await this.generatePageFiles(),s="generate_page_files"):this.isMobile?i=await this.generateSiteFilesFromDescription():(i=await this.generateSiteFilesFromOutline(),s="generate_site_files_from_outline"),i){const i=setTimeout((function(){clearInterval(t),e.showPopup({title:twbb_ai_builder.retry_title,desc:this.isSinglePage?twbb_ai_builder.retry_single_page_description:twbb_ai_builder.retry_description,buttonText:twbb_ai_builder.retry_button,class:"retry"})}),32e4);t=setInterval((async()=>{const a=await this.getSiteData(s);"string"==typeof a&&(clearInterval(t),clearTimeout(i),await e.templateImport(a,s)),!1===a&&(clearInterval(t),clearTimeout(i),e.showPopup({title:twbb_ai_builder.retry_title,desc:twbb_ai_builder.retry_description,buttonText:twbb_ai_builder.retry_button,class:"retry"}),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Failed",eventLabel:"",websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",uniqueId:e.uniqueId,isMobile:e.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Failed",eventLabel:"",websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",uniqueId:e.uniqueId,isMobile:e.isMobile}))}),1e4)}}installWoocommerce(){try{const e={action:"twbb_check_woocommerce",nonce:twbb_ai_builder.twbb_generate_nonce};jQuery.ajax({type:"POST",url:twbb_ai_builder.ajax_url,data:e,success:function(e){console.log(e),"success"===e?.status&&console.log(e?.msg)}})}catch(e){console.log(e)}}templateImport(e,t){const i=this;return new Promise(((s,a)=>{try{const s={business_description:i.params.business_description,business_name:i.params.business_name,business_type:i.params.business_type,website_type:i.params.website_type,theme:i.params.theme,fonts:i.params.fonts,colors:i.params.colors},n={action:"twbb_import_template",nonce:twbb_ai_builder.twbb_generate_nonce,url:e,ai2_action:"generate_page_files"===t?"build_secondary_page":"build_site_from_outline",website_data:JSON.stringify(s)};jQuery.ajax({type:"POST",url:twbb_ai_builder.ajax_url,data:n,success:function(e){e.success?(i.completeSteps(),i.showPopup({title:twbb_ai_builder.congrats_popup_title,desc:i.isSinglePage?twbb_ai_builder.congrats_popup_single_page_desc:i.isMobile?twbb_ai_builder.congrats_popup_desc_mobile:twbb_ai_builder.congrats_popup_desc,buttonText:i.isMobile?twbb_ai_builder.congrats_popup_button_mobile:twbb_ai_builder.preview_edit,class:"congrats",link:i.isMobile?twbb_ai_builder.home_url:twbb_ai_builder.admin_post_url+`?post=${e.data}&action=elementor`}),twbb_ai_builder.reseller_mode?(twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Success pop-up opened",eventLabel:"",uniqueId:i.uniqueId,isMobile:i.isMobile}),twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Successful Generation",eventLabel:"",websiteType:"basic"===i.params.website_type?"Business":"Ecommerce",uniqueId:i.uniqueId,isMobile:i.isMobile})):(twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Success pop-up opened",eventLabel:"",uniqueId:i.uniqueId,isMobile:i.isMobile}),twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Successful Generation",eventLabel:"",websiteType:"basic"===i.params.website_type?"Business":"Ecommerce",uniqueId:i.uniqueId,isMobile:i.isMobile}))):a(new Error("Unexpected response format or request not successful."))},error:function(e,t,i){a(new Error(`AJAX error: ${t} - ${i}`))}})}catch(e){a(e)}}))}async generatePageFiles(){const e=this.params,t=safeJsonParse(twbb_ai_builder.imported_site_data),i={page_description:e.page_description,page_outline:e.page_outline,page_title:e.page_title,page_type:e.page_type,post_status:e.post_status,slug:e.slug,website_type:t?.website_type,business_type:t?.business_type,business_name:t?.business_name,business_description:t?.business_description,theme:t?.theme,fonts:t?.fonts,colors:t?.colors,blog:{posts_count:twbb_ai_builder.posts_count},tier1:!1,website_design_type_level:1};"ecommerce"===i.website_type&&(i.woocommerce={woocommerce_active:!!twbb_ai_builder.woocommerce_active,shop_page_id:twbb_ai_builder.shop_page_id,products_count:twbb_ai_builder.products_count});const s={uniqueId:this.uniqueId,params:JSON.stringify(i)};try{let e=`ai2/workspaces/${twbb_ai_builder.workspace_id}/generate_page_files`;twbb_ai_builder.reseller_mode&&(e="builder/generate_page_files");if(await twbbRequests("POST",e,!0,JSON.stringify(s)))return localStorage.removeItem("single_page"),!0}catch(e){return console.log("Error fetching data",e),!1}}async generateSiteFilesFromDescription(){const e=this.params,{unique_id:t,...i}=e,s=new URLSearchParams;s.append("params",JSON.stringify(i)),s.append("uniqueId",this.uniqueId),s.append("service_key","gTcjslfqqBFFwJKBnFgQYhkQEJpplLaDKfj");try{let e=`ai2/workspaces/${twbb_ai_builder.workspace_id}/generate_site_files_from_description`;twbb_ai_builder.reseller_mode&&(e="builder/generate_site_files_from_description");if(await twbbRequests("POST",e,!0,s,"application/x-www-form-urlencoded; charset=UTF-8"))return localStorage.removeItem("formData"),!0}catch(e){return console.log("Error fetching data",e),!1}}async generateSiteFilesFromOutline(){const e=this.params,{generated_color:t,...i}=e,s={params:JSON.stringify(i),uniqueId:this.uniqueId};try{let e=`ai2/workspaces/${twbb_ai_builder.workspace_id}/generate_site_files_from_outline`;twbb_ai_builder.reseller_mode&&(e="builder/generate_site_files_from_outline");if(await twbbRequests("POST",e,!0,JSON.stringify(s)))return localStorage.removeItem("builder_history"),localStorage.removeItem("fieldData"),!0}catch(e){return console.log("Error fetching data",e),!1}}async getSiteData(e){const t=this.uniqueId;try{let i=`ai2/workspaces/${twbb_ai_builder.workspace_id}/get-data?uniqueId=${t}&action=${e}`;twbb_ai_builder.reseller_mode&&(i=`builder/get-data?uniqueId=${t}&action=${e}`);const s=await twbbRequests("GET",i,!0);if(200===s.status)return s.data}catch(e){return console.log("Error fetching data",e),!1}}showPopup(e){const t=jQuery(".twbb-ai-builder-overlay");t.find(".title").html(e.title),t.find(".desc").html(e.desc),t.find(".twbb-ai-builder__popup").removeAttr("class").addClass("twbb-ai-builder__popup").addClass(e.class),t.find(".preview-edit").html(e.buttonText),e.link&&t.find(".preview-edit").attr("href",e.link),t.find(".preview-edit").attr("target","congrats"===e.class?"_blank":null),t.removeClass("hidden")}completeSteps(){jQuery(document).find(".twbb-ai-builder__content .generate-steps li").each((function(){jQuery(this).addClass("active"),jQuery(this).find(".icon").removeClass("process").addClass("passed")}))}printSteps(){let e=0,t='<ul class="generate-steps">';for(const i in this.steps){t+=`<li class="${0===e?"process active":""} " >${0===e?'<span class="icon process"></span>':""} ${this.steps[i].label}</li>`,e++}t+="</ul>",this.container.find(".twbb-ai-builder__content").html(t),this.setStepProcessing()}changeInfo(){const e=this.container,t=safeJsonParse(twbb_ai_builder.imported_site_data),i=this.isSinglePage?t?.website_type:this.params.website_type,s=twbb_ai_builder.image_url+`banners/${i}.jpg`,a=this.isSinglePage?twbb_ai_builder.generating_single_page_title:twbb_ai_builder.generating_title;e.find(".twbb-ai-builder__title").html(a),e.find(".twbb-ai-builder__left-banner").css("background-image",`url(${s})`)}setStepProcessing(){let e=-1;const t=setInterval((()=>{e++;const i=this.container.find(".twbb-ai-builder__content li").eq(e),s=this.container.find(".twbb-ai-builder__content li").eq(e+1),a=this.steps.length-1;e>a&&(e=a),e!==a&&(e===a?i.addClass("active").prepend("<span class='icon process'></span>"):(i.addClass("active").find(".icon").remove(),i.prepend("<span class='icon passed'></span>"))),e!==a?s.addClass("active").prepend("<span class='icon process'></span>"):clearInterval(t)}),1e4)}}class TwbbWebsiteType{constructor(){this.container=jQuery('.twbb-ai-builder__container[data-type="websiteType"]')}setAnimations(e){twbbSetAnimations(e)}}class TwbbAIBuilder{constructor(e){this.uniqueId="",this.isSinglePage=e,this.isMobile=matchMedia("screen and (max-width: 768px)").matches,this.importedSiteData=safeJsonParse(twbb_ai_builder.imported_site_data),this.historyKey=this.isSinglePage?"single_page":this.isMobile?"formData":"builder_history",this.ecomData={},this.step=1,this.params={business_type:"",business_name:"",business_description:"",website_type:"",tier1:!1},this.paramsFromOutline={},this.twbbWebsiteStyle=new TwbbWebsiteStyle(this.historyKey,this.uniqueId,this.isMobile),this.twbbEcommerceData=new TwbbEcommerceData;const t={};Object.keys(t).length>0&&(this.params={business_type:t.business_type??"",business_name:t.business_name??"",business_description:t.business_description??"",website_type:t.website_type??"",unique_id:t.unique_id??"",tier1:!1},this.isMobileHistory=!0,this.ecomData=t.ecomData??{},this.uniqueId=t.unique_id??""),this.isBack=!1}selectWebsiteType(e){jQuery(".twbb-ai-builder__btn.next").removeClass("disabled"),jQuery(".twbb-ai-builder").attr("data-websiteType",e),this.params.website_type=e}changeStep(e,t=0){const i=this,s=jQuery(".twbb-ai-builder__container"),a=e.hasClass("next"),n=e.hasClass("generate"),o=jQuery(".twbb-ai-builder__btn.next"),r=0!==t?t-1:parseInt(jQuery(".twbb-ai-builder__container:visible").attr("data-step"));let l=a?r+1:r-1;if(l=0!==t?t:l,"ecommerce"!==this.params.website_type&&3===r&&a&&(l=5,o.addClass("disabled")),1!==l||a){if(5===r&&!a){if(!this.isSinglePage)return this.isBack=!0,void this.showLeavePopup();l=3}}else this.websiteType(),o.addClass("disabled");3===r&&a&&this.setBusinessInfo(),n&&(l=7);const b=jQuery(`.twbb-ai-builder__container[data-step="${l}"]`),c=b.attr("data-type");"function"==typeof this[c]&&this[c]();setTimeout((function(){s.closest(".twbb-ai-builder").attr("data-websiteType",i.params.website_type).attr("data-type",c).attr("data-generationType",i.isSinglePage?"single_page":"website"),s.addClass("hidden"),b.removeClass("hidden"),4!==l&&5!==l&&i.checkButtonState("button")}),2===l||3===l?500:0)}checkButtonState(e=""){const t=jQuery(".twbb-ai-builder__btn.next"),i=jQuery(".twbb-ai-builder__container:visible").find(".twbb-input").filter((function(){const e=jQuery(this);if("text"===e.attr("type"))return""===jQuery.trim(e.val());if("radio"===e.attr("type")){const t=e.attr("name");return!jQuery(`input[type="radio"][name="${t}"]:checked`).length}return!1}));i.length&&t.addClass("disabled"),"button"!==e||i.length||t.removeClass("disabled")}showLeavePopup(){const e=jQuery(".twbb-ai-builder-overlay");e.find(".title").html(twbb_ai_builder.leave_popup_title),e.find(".desc").html(twbb_ai_builder.leave_popup_desc),e.find(".twbb-ai-builder__popup").addClass("leave"),e.removeClass("hidden")}setBusinessInfo(e=""){this.params.business_name=jQuery("#business-name").val(),this.params.business_description=jQuery("#business-description").val(),this.setMobileHistory(this.params),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Question answered",eventLabel:'["company_name","company_description"]',websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",companyType:this.params.business_type,uniqueId:this.uniqueId,isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Question answered",eventLabel:'["company_name","company_description"]',websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",companyType:this.params.business_type,uniqueId:this.uniqueId,isMobile:this.isMobile})}websiteType(){this.removeMobileData(),this.removeData();(new TwbbWebsiteType).setAnimations()}removeMobileData(){localStorage.removeItem("formData"),this.params={business_type:"",business_name:"",business_description:"",website_type:"",tier1:!1}}removeData(){jQuery('.radio[name="website_type"]').prop("checked",!1),jQuery(".twbb-input:not(.twbb-radio)").val(""),sessionStorage.removeItem("sessionId")}async businessType(){const e=this;this.uniqueId=await e.getUniqueId();const t=new TwbbBusinessType(this.params);t.changeInfo(),t.getOptions(),jQuery(".option-search .search").on("focus",(function(){t.showOptions()})).on("keyup",(function(){t.searchOptions(jQuery(this),e.params.website_type),e.checkButtonState()})).on("click",(function(){""!==jQuery(this).val()&&t.searchOptions(jQuery(this),e.params.website_type)})),jQuery("body").on("click",(function(){t.hideOptions()})),jQuery(".select_container").on("click",(function(e){e.stopPropagation()})),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Generative AI - Website type selected",eventLabel:"Section-based AI Flow",websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Generative AI - Website type selected",eventLabel:"Section-based AI Flow",websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",isMobile:this.isMobile})}async aboutWebsite(){this.isSinglePage&&(this.uniqueId=await this.getUniqueId()),jQuery(".twbb-ai-builder__btn.next").addClass("disabled");const e=jQuery("#business-type").val();""!==e&&(this.params.business_type=e);const t={},i=new TwbbAboutWebsite(this.params,this.isSinglePage),s=this.isMobile&&t?t?.info:{},a=await i.changeInfo(this.params,s);this.setMobileHistory({...this.params,info:a}),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Question answered",eventLabel:'["business_type"]',websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",companyType:this.params.business_type,isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Question answered",eventLabel:'["business_type"]',websiteType:"basic"===this.params.website_type?"Business":"Ecommerce",companyType:this.params.business_type,isMobile:this.isMobile})}async ecommerceData(){this.ecomData=await this.twbbEcommerceData.ecomData(this.uniqueId,this.params)||{},this.setMobileHistory(this.params)}outline(e=""){this.changeEcomData(),jQuery(".twbb-ai-builder__btn.next").addClass("disabled");const t=this,i=document.getElementById("outline-view");let s={generation:{...t.params,unique_id:this.uniqueId},callbackFn:function(i){t.paramsFromOutline=i,""===e&&t.setHistory(i),console.log(i)},eventCallback:function(e){const i=e?.action??"Section-based AI Flow - Outline Generated";twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:i,eventLabel:"",uniqueId:t.uniqueId,isMobile:t.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:i,eventLabel:"",uniqueId:t.uniqueId,isMobile:t.isMobile})},builder_api:twbb_ai_builder.builder_api,saved_data:null,workspace_id:twbb_ai_builder.workspace_id,access_token:twbb_ai_builder.access_token,elements_path:twbb_ai_builder.elements_path,lang:twbb_ai_builder.lang};t.isSinglePage&&(s.new_page=!0,s.generation.website_type=this.importedSiteData?.website_type,s.generation.business_type=this.importedSiteData?.business_type);const a=new TwbbOutline;i.show=!0,t.isBack?(i.resetValue=s,i.formValue=null,t.isBack=!1):(i.formValue=s,i.resetValue=null),i.addEventListener("loaded",(function(e){!0===e.detail&&a.changeInfo()}))}websiteStyle(){const e=this.paramsFromOutline;this.twbbWebsiteStyle.setColorsThemes(e),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Outline Submitted",eventLabel:"",uniqueId:this.uniqueId,isMobile:this.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Outline Submitted",eventLabel:"",uniqueId:this.uniqueId,isMobile:this.isMobile})}generation(){this.isMobile&&this.changeEcomData();const e=this.twbbWebsiteStyle.getActiveThemes(),t=this.paramsFromOutline;let i="ecommerce"===this.params.website_type?{...t,ecom_data:this.ecomData}:t;const s=i;this.isMobile?(delete s.info,localStorage.removeItem("formData")):(s.colors=e?.colors??i.colors,s.fonts=e?.fonts??i.fonts,s.theme=e?.theme??i.theme,localStorage.removeItem("builder_history"),localStorage.removeItem("fieldData"));new TwbbGeneration(s,this.uniqueId,this.params.website_type,this.isMobile,this.isSinglePage).generateWebsite()}async getUniqueId(){let e="";try{let t="ai2/start_generation_session";twbb_ai_builder.reseller_mode&&(t="builder/start_generation_session");const i=await twbbRequests("POST",t,!0);if(i&&200===i.status)return e=i.data?.uniqueId,sessionStorage.setItem("sessionId",e),e}catch(t){return console.log("Error fetching data",t),e}}changeEcomData(){let e=[];jQuery(".twbb-input.ecom_data").each((function(){const t=jQuery(this).val();e.push(t)})),this.ecomData.categories&&(this.ecomData.categories=e)}setHistory(e){let t=e;t.unique_id=this.uniqueId,t.website_type=this.params.website_type,t.ecom_data=this.ecomData,localStorage.setItem(this.historyKey,JSON.stringify(t))}setMobileHistory(e){if(!this.isMobile||this.isSinglePage)return;let t=e;if(localStorage.getItem(this.historyKey)){t={...JSON.parse(localStorage.getItem(this.historyKey)),...t}}else t.unique_id=this.uniqueId,t.website_type=this.params.website_type,t.ecom_data=this.ecomData,t.image_model="default",t.trial_hosted_flow=0,t.ai_type="ai_builder_demo",t.domain_name={want_domain:0,domain_name:""};localStorage.setItem(this.historyKey,JSON.stringify(t))}}let twbbAIBuilder;jQuery(document).ready((function(){matchMedia("screen and (max-width: 768px)").matches;const e=document.getElementById("outline-view");twbbAIBuilder=new TwbbAIBuilder;"1"===new URLSearchParams(window.location.search).get("open_ai_generation")&&(jQuery(".twbb-ai-builder").removeClass("hidden"),jQuery('.twbb-ai-builder__container[data-type="websiteType"]').removeClass("hidden")),jQuery(document).on("change",".radio[name='website_type']",(function(){twbbAIBuilder.selectWebsiteType(jQuery(this).val())})),jQuery(document).on("change",".twbb-ai-builder__container[data-type='businessType'] .twbb-input",(function(){twbbAIBuilder.setBusinessInfo("button")})),jQuery(document).on("click",".twbb-ai-builder__btn.next,.twbb-ai-builder__btn.back",(function(){twbbAIBuilder.changeStep(jQuery(this))})),jQuery(document).on("click",".twbb-ai-builder__btn.cancel",(function(){return jQuery(".twbb-ai-builder-overlay").addClass("hidden"),!1})),jQuery(document).on("click",".twbb-ai-builder__btn.leave",(function(){twbbAIBuilder.changeStep(jQuery(this),1),localStorage.removeItem("builder_history"),localStorage.removeItem("fieldData"),twbbAIBuilder.removeData(),e.show=!1,jQuery(".twbb-ai-builder-overlay").addClass("hidden"),twbb_ai_builder.reseller_mode?twbSendEventToRouth({eventCategory:"Reseller Action",eventAction:"Section-based AI Flow - Leave Outline editor",eventLabel:"",websiteType:"basic"===twbbAIBuilder.params.website_type?"Business":"Ecommerce",uniqueId:twbbAIBuilder.uniqueId,isMobile:twbbAIBuilder.isMobile}):twbSendEventToPublicRouth({eventCategory:"Hosted Website Action",eventAction:"Section-based AI Flow - Leave Outline editor",eventLabel:"",websiteType:"basic"===twbbAIBuilder.params.website_type?"Business":"Ecommerce",uniqueId:twbbAIBuilder.uniqueId,isMobile:twbbAIBuilder.isMobile})})),jQuery(document).on("click",".twbb-ai-builder-page__button",(function(){const e=jQuery(this).attr("data-id"),t="single_page"===e;let i;i="generate"===e?1:3,jQuery(".twbb-ai-builder").removeClass("hidden"),jQuery("body").addClass("not-scroll"),twbbAIBuilder=new TwbbAIBuilder(t),twbbAIBuilder.removeData(),twbbAIBuilder.changeStep(jQuery(".twbb-ai-builder__btn.next:not(.generate)"),i)})),jQuery(document).on("click",".twbb-ai-builder__close, .twbb-ai-builder[data-type='websiteType'] .twbb-ai-builder__btn.back,  .twbb-ai-builder[data-type='outline'] .twbb-ai-builder__btn.back",(function(){twbbAIBuilder.removeData(),jQuery(".twbb-ai-builder, .twbb-ai-builder__container").addClass("hidden"),jQuery("body").removeClass("not-scroll"),e.show=!1,e.formValue=null}))}));