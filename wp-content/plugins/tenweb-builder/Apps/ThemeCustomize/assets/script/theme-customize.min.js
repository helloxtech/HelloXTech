class ThemeCustomize{constructor(){this.from_demo=twbb_theme_customize.from_demo,this.active_font=twbb_theme_customize.active_font,this.fonts=twbb_theme_customize.fonts,this.active_color=twbb_theme_customize.active_color,this.colors=twbb_theme_customize.colors,this.kitEnablePopupOpened=0,this.ultimateKitSaved=!1,this.existingBodyStyles=""}init(){this.registerEvents(),this.from_demo&&this.setActiveTheme(),0!=this.getCookie("tbdemo_first_time")&&this.open_customize("color")}registerEvents(){let e=this;jQuery(document).off("click",".twbb-theme-customize-tab").on("click",".twbb-theme-customize-tab",(function(){let t=jQuery(this).attr("id"),o=jQuery(this).closest(".twbb-theme-customize-container");jQuery(this).closest(".twbb-theme-customize-tabs").find(".twbb-theme-customize-tab").removeClass("twbb-theme-customize-tab-active"),jQuery(this).addClass("twbb-theme-customize-tab-active"),o.find(".twbb-theme-customize-tab-content").hide(),o.find("."+t+"-content").show(),"twbb-theme-customize-font"==t?e.open_customize("font"):e.open_customize("color")})),jQuery(document).on("input",".twbb-font-search-input",(function(){let t=jQuery(this).val(),o=e.sortBySearch(t,e.fonts),i="";o.length?o.forEach((function(t){t==e.active_font?i+="<div class='twbb-font-active'><span style='font-family: "+t+"'>"+t+"</span></div>":i+="<div><span style='font-family: "+t+"'>"+t+"</span></div>"})):i+='<div class="twbb-font-noresult">0 results found for "'+t+'"</div>',jQuery(document).find(".twbb-font-list").empty().append(i)})),jQuery(document).off("click",".twbb-font-list > div").on("click",".twbb-font-list > div",(function(){if(jQuery(this).hasClass("twbb-font-noresult"))return!1;e.active_font=jQuery(this).text(),jQuery(document).find(".twbb-font-list > div").removeClass("twbb-font-active"),jQuery(this).addClass("twbb-font-active");let t=jQuery(this).find("span").text();e.changeThemeStyle(t,"font")})),jQuery(document).off("click",".twbb-color-item").on("click",".twbb-color-item",(function(){e.ultimateKitSaved=!1,window.ultimateKitSaved=!1;let t=jQuery("#tbdemo-device-iframe").contents().find("body");e.existingBodyStyles=t.attr("style"),e.active_color=jQuery(this).data("pallet_id"),jQuery(document).find(".twbb-color-item").removeClass("twbb-color-active"),jQuery(this).addClass("twbb-color-active"),e.changeThemeStyle(jQuery(this),"color")})),jQuery(document).on("click",".tbdemo-customize",(function(){e.open_customize("color")})),jQuery(document).on("click",".tbdemo-device-mobile",(function(){if(jQuery(this).hasClass("tbdemo-device-active"))return;if("undefined"!=typeof WebFont&&null!=e.active_font){let t=document.getElementById("tbdemo-device-iframe");WebFont.load({google:{families:[e.active_font]},context:t.contentWindow})}else"undefined"!=typeof elementor&&(elementor.helpers.enqueueFont(e.active_font,"editor"),elementor.helpers.enqueueFont(e.active_font));let t=jQuery("#tbdemo-device-iframe").contents().find("body");if(null!=e.active_color&&""!=e.active_color){let o=e.colors.filter((t=>t.id===e.active_color));o.length&&(o=o[0].kit,t.length&&e.changeColors(t,o))}t.length&&null!=e.active_font&&e.changeFonts(t,e.active_font)})),jQuery(document).on("click",".twbb-customize-enable-popup-activate-button",(function(){e.addUltimateKit(this)})),jQuery(document).on("click",".twbb-customize-enable-popup-cancel-button, .twbb-customize-enable-popup-close, .twbb-customize-enable-popup-layout",(function(){e.closeCustomizeEnablePopup()})),jQuery(document).on("click",".twbb-theme-customize-close",(function(){jQuery(document).find(".twbb-customize-layout").hasClass("twbb-animated-sidebar-show")&&twbb_animate_sidebar("close",jQuery(document).find(".twbb-customize-layout"),300,"twbb-customization-sidebar-opened",theme_Customize.close_customization)})),jQuery(document).on("click",".twbb-theme-customize-button-editor",(function(){analyticsDataPush("Open Global Styles Update pop-up","10Web Styles","");let e=jQuery(document).find("#twbb-customize-save-popup-template").html();jQuery(document).find("#elementor-editor-wrapper-v2").append(e)})),jQuery(document).on("click",".twbb-customize-save",(function(){let t=jQuery(".twbb-theme-customize-tab-content .twbb-color-item.twbb-color-active").attr("data-pallet_id");analyticsDataPush("Save Global Styles Update pop-up","10Web Styles",t),e.saveCustomization(jQuery(document).find(".twbb-theme-customize-button-editor"))})),jQuery(document).on("click",".twbb-customize-cancel, .twbb-customize-save-popup-close, .twbb-customize-save-popup-layout",(function(){analyticsDataPush("Cancel Global Styles Update pop-up","10Web Styles",""),e.closeSaveCustomizationPopup()}))}addUltimateKit(e){if(jQuery(e).hasClass("twbb-customize-enable-popup-loading"))return!1;let t=this;jQuery(e).addClass("twbb-customize-enable-popup-loading"),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"twbb_mergeUltimateKit_kit",nonce:twbb_theme_customize.ajaxnonce}}).success((function(e){if(e.success)if(twbb_options.show_ultimate_kit=1,t.closeCustomizeEnablePopup(),t.kitEnablePopupOpened){jQuery(document).find(".twbb-customize-button").trigger("click");let e=jQuery("#twbb-customize-empty-reload-content-template").html();jQuery(document).find(".twbb-theme-customize-tabs, .twbb-theme-customize-content, .twbb-theme-customize-footer").remove(),jQuery(document).find(".twbb-theme-customize-container").append(e)}else{jQuery(document).find(".twbb-sg-header-button-container").trigger("click");let e=jQuery("#twbb-sg-sidebar-empty-reload-content-template").html();jQuery(document).find(".twbb-sg-sidebar-content").empty().append(e)}})).complete((function(t){jQuery(e).removeClass("twbb-customize-enable-popup-loading")})).error((function(e,t,o){return console.log("Something Wrong when inserting generated section template."),!1}))}openCustomizeEnablePopup(){let e=jQuery(document).find("#twbb-customize-activate-popup-template").html();jQuery(document).find(".twbb-customize-enable-popup-layout").length||jQuery("body").append(e),jQuery(document).find(".twbb-customize-enable-popup-layout").show(),jQuery(document).find(".twbb-customize-enable-popup").show()}closeCustomizeEnablePopup(){jQuery(document).find(".twbb-customize-enable-popup-layout").hide(),jQuery(document).find(".twbb-customize-enable-popup").hide()}open_customize(e){let t=this;"font"==e?setTimeout((function(){jQuery(document).find(".twbb-font-list").scroll((function(){t.visibleFontsList(jQuery(this))})),t.visibleFontsList(jQuery(document).find(".twbb-font-list")),t.scrollToActiveFont()}),500):(jQuery(document).find(".twbb-color-item").removeClass("twbb-color-active"),jQuery(document).find(".twbb-color-item[data-pallet_id='"+t.active_color+"']").addClass("twbb-color-active"))}closeSaveCustomizationPopup(){jQuery(document).find(".twbb-customize-save-popup-layout, .twbb-customize-save-popup").remove()}saveCustomization(e){if(this.closeSaveCustomizationPopup(),jQuery(e).hasClass("twbb-theme-customize-button-loading"))return;jQuery(e).addClass("twbb-theme-customize-button-loading");let t=twbb_theme_customize.rest_route+"/save_customization",o=new FormData;o.append("font",this.active_font),o.append("color",this.active_color),fetch(t,{method:"POST",headers:{"X-WP-Nonce":twbb_theme_customize.ajaxnonce},body:o}).then((e=>e.json())).then((t=>{t.success&&(self.ultimateKitSaved=!0,window.ultimateKitSaved=!0,jQuery(document).find(".twbb-customize-button.selected").trigger("click")),jQuery(e).removeClass("twbb-theme-customize-button-loading")})).catch((t=>{jQuery(e).removeClass("twbb-theme-customize-button-loading")}))}close_customization(){jQuery(document).find(".twbb-customize-button").removeClass("selected"),jQuery(document).find('.MuiButtonBase-root[aria-label="Add Element"]').addClass("Mui-selected"),jQuery(document).find(".twbb-customize-layout").removeClass("twbb-animated-sidebar-show").addClass("twbb-animated-sidebar-hide"),jQuery("#elementor-preview-iframe").contents().find("#elementor-add-new-section").show(),jQuery("#elementor-preview-iframe").contents().find("body").find(".twbb-customize-preview-layout").hide(),this&&!this.ultimateKitSaved&&window&&!window.ultimateKitSaved&&(this.changeThemeStyle(this,"color","remove"),this.changeThemeStyle(this,"font","remove"))}getCookie(e){let t=e+"=",o=decodeURIComponent(document.cookie).split(";");for(let e=0;e<o.length;e++){let i=o[e];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}setActiveTheme(){let e=this,t=this.getCookie("twbb_theme_color"),o=this.getCookie("twbb_theme_font");t||(t=e.active_color),o||(o=e.active_font),""!=t&&(this.active_color=t,this.changeThemeStyle(this,"color")),""!=o&&(this.active_font=o,"undefined"!=typeof WebFont&&null!=this.active_font?(WebFont.load({google:{families:[this.active_font]}}),setTimeout((function(){jQuery("#tbdemo-device-iframe").load((function(){let t=document.getElementById("tbdemo-device-iframe");WebFont.load({google:{families:[e.active_font]},context:t.contentWindow}),e.changeThemeStyle(o,"font")}))}),2e3)):"undefined"!=typeof elementor&&(elementor.helpers.enqueueFont(this.active_font,"editor"),elementor.helpers.enqueueFont(this.active_font)),this.changeThemeStyle(o,"font"))}changeThemeStyle(e,t,o="add"){let i=this,n="",s="";if(i.from_demo?n=jQuery("#tbdemo-device-iframe").contents().find("body"):(n=jQuery("#elementor-preview-iframe").contents().find("body"),s=jQuery(".twbb-sg-sidebar-navigated-content iframe")),"font"==t){let t=e;i.from_demo&&(document.cookie="twbb_theme_font="+t+"; path=/"),this.changeFonts(jQuery("body"),t,o),n.length&&this.changeFonts(n,t,o),""!==s&&s.contents().find("body").length&&s.each((function(){let e=jQuery(this).contents(),n="https://fonts.googleapis.com/css?family="+t+":100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic";elementor.helpers.enqueueCSS(n,e),i.changeFonts(e.find("body"),t,o)}))}else if("color"==t){i.from_demo&&(document.cookie="twbb_theme_color="+this.active_color+"; path=/");let e=this.colors.filter((e=>e.id===this.active_color));e.length&&(e=e[0].kit,this.changeColors(jQuery("body"),e,o),n.length&&this.changeColors(n,e),""!==s&&s.contents().find("body").length&&s.each((function(){let t=jQuery(this).contents();i.changeColors(t.find("body"),e,o)})))}}changeColors(e,t,o="add"){let i=[].concat(t.custom_colors,t.system_colors);if("add"===o)for(let t of i)e.css("--e-global-color-"+t._id,t.color);else void 0!==this.existingBodyStyles?e.attr("style",this.existingBodyStyles):e.removeAttr("style")}changeFonts(e,t,o="add"){if("add"===o)for(let o of twbb_theme_customize.typography_ids)e.css("--e-global-typography-"+o+"-font-family",t);else void 0!==this.existingBodyStyles?e.attr("style",this.existingBodyStyles):e.removeAttr("style")}scrollToActiveFont(){let e=this;jQuery(document).find(".twbb-font-list:visible > div").removeClass("twbb-font-active"),jQuery(document).find(".twbb-font-list:visible > div").filter((function(){return jQuery(this).text().trim()===e.active_font})).addClass("twbb-font-active");let t="",o=jQuery(document).find(".twbb-font-list:visible");void 0!==o&&o.length&&o.each((function(){t=jQuery(this).find(".twbb-font-active"),void 0!==t&&t.length&&(e.from_demo?jQuery(this).scrollTop(jQuery(this).scrollTop()+t.position().top-100):jQuery(this).scrollTop(jQuery(this).scrollTop()+t.position().top-200))}))}sortBySearch(e,t){jQuery(document).find(".twbb-font-list:visible").scrollTop(0);const o=Object.values(t);return 0===o.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).length?[]:(o.sort(((t,o)=>{const i=t.toLowerCase().startsWith(e.toLowerCase()),n=o.toLowerCase().startsWith(e.toLowerCase());return i&&!n?-1:!i&&n?1:t.toLowerCase().localeCompare(o.toLowerCase())})),o)}visibleFontsList(e){clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((function(){let t=[],o=jQuery(e),i=o.offset().top,n=i+o.height();o.find("div").each((function(){let e=jQuery(this),o=e.offset().top,s=o+e.outerHeight();if(o>=i&&o<=n||s>=i&&s<=n){let o=e.text().trim();if(t.push(o),"undefined"!=typeof WebFont&&null!=o&&""!=o){let e=document.getElementById("tbdemo-device-iframe");null!=e&&WebFont.load({google:{families:[o]},context:e.contentWindow}),WebFont.load({google:{families:[o]}})}else"undefined"!=typeof elementor&&(elementor.helpers.enqueueFont(o,"editor"),elementor.helpers.enqueueFont(o))}}))}),250)}}